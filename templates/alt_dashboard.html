<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TailSentry - Alternative Dashboard</title>
  <link rel="stylesheet" href="/static/tailwind.min.css">
  <link rel="stylesheet" href="/static/dark-mode-addon.css">
  <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
  <script src="/static/alpine.min.js" defer></script>
    <script src="/static/alpine.min.js" defer></script>
    <script src="/static/alt_dashboard.js" defer></script>
  <style>
    .card { @apply bg-white shadow rounded-lg p-6 mb-4; }
    .card-dark { @apply bg-gray-800 text-gray-100; }
    .section-title { @apply text-lg font-semibold mb-2; }
  </style>
</head>
<body x-data="window.altTailSentry()" x-init="init()" :class="{ 'dark': darkMode }" class="min-h-screen bg-gray-50 dark:bg-gray-900">
  <!-- Header -->
  <header class="flex items-center justify-between px-6 py-4 bg-indigo-600 text-white shadow">
    <div class="flex items-center gap-3">
      <img src="/static/favicon.svg" class="h-8 w-8" alt="TS">
      <span class="font-bold text-xl tracking-tight">TailSentry</span>
      <span class="ml-2 px-2 py-1 bg-indigo-800 rounded text-xs">ALPHA UI</span>
    </div>
    <div class="flex items-center gap-4">
      <button @click="openSettings = true" class="hover:bg-indigo-700 px-3 py-1 rounded transition">⚙️ Settings</button>
      <button @click="logout()" class="bg-red-500 hover:bg-red-600 px-3 py-1 rounded">Logout</button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto py-8 px-4 grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Device Overview -->
    <section class="col-span-1 card" :class="{ 'card-dark': darkMode }">
      <div class="section-title">Device Overview</div>
      <div class="mb-2"><span class="font-semibold">Hostname:</span> <span x-text="device.hostname"></span></div>
      <div class="mb-2"><span class="font-semibold">Tailscale IP:</span> <span x-text="device.ip"></span></div>
      <div class="mb-2"><span class="font-semibold">Status:</span> <span :class="device.online ? 'text-green-600' : 'text-red-600'" x-text="device.online ? 'Online' : 'Offline'"></span></div>
      <div class="mb-2"><span class="font-semibold">Role:</span> <span x-text="device.role"></span></div>
      <div class="mb-2"><span class="font-semibold">Uptime:</span> <span x-text="device.uptime"></span></div>
      <div class="mb-2"><span class="font-semibold">Exit Node:</span> <span x-text="device.isExit ? 'Yes' : 'No'"></span></div>
      <div class="mb-2"><span class="font-semibold">Subnet Routes:</span> <span x-text="subnets.length"></span></div>
      <button @click="refresh()" class="mt-2 px-3 py-1 bg-indigo-500 text-white rounded hover:bg-indigo-600">Refresh</button>
    </section>

    <!-- Peers List -->
    <section class="col-span-2 card" :class="{ 'card-dark': darkMode }">
      <div class="section-title flex items-center justify-between">
        <span>Connected Devices</span>
        <input type="text" x-model="peerFilter" placeholder="Search..." class="px-2 py-1 rounded border border-gray-300 dark:bg-gray-700 dark:text-gray-100">
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead>
            <tr class="bg-gray-100 dark:bg-gray-700">
              <th class="px-2 py-1">Hostname</th>
              <th class="px-2 py-1">IP</th>
              <th class="px-2 py-1">OS</th>
              <th class="px-2 py-1">Last Seen</th>
              <th class="px-2 py-1">Tags</th>
              <th class="px-2 py-1">Status</th>
              <th class="px-2 py-1">Actions</th>
            </tr>
          </thead>
          <tbody>
            <template x-for="peer in filteredPeers()" :key="peer.id">
              <tr class="hover:bg-gray-50 dark:hover:bg-gray-800">
                <td class="px-2 py-1 font-medium" x-text="peer.hostname"></td>
                <td class="px-2 py-1" x-text="peer.ip"></td>
                <td class="px-2 py-1" x-text="peer.os"></td>
                <td class="px-2 py-1" x-text="peer.lastSeen"></td>
                <td class="px-2 py-1" x-text="peer.tags.join(', ')"></td>
                <td class="px-2 py-1">
                  <span :class="peer.online ? 'text-green-600' : 'text-red-600'" x-text="peer.online ? 'Online' : 'Offline'"></span>
                </td>
                <td class="px-2 py-1">
                  <button @click="pingPeer(peer)" class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200">Ping</button>
                  <button @click="openPeerModal(peer)" class="text-xs bg-gray-200 text-gray-800 px-2 py-1 rounded hover:bg-gray-300 ml-1">Details</button>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Network Traffic & Stats -->
    <section class="col-span-3 card" :class="{ 'card-dark': darkMode }">
      <div class="section-title">Network Traffic</div>
      <div class="flex gap-8 mb-2">
        <div><span class="font-semibold">Upload:</span> <span x-text="net.tx"></span></div>
        <div><span class="font-semibold">Download:</span> <span x-text="net.rx"></span></div>
        <div><span class="font-semibold">Active Peers:</span> <span x-text="peers.length"></span></div>
        <div><span class="font-semibold">Last Updated:</span> <span x-text="lastUpdated"></span></div>
      </div>
      <div class="w-full h-2 bg-gray-200 dark:bg-gray-700 rounded overflow-hidden">
        <div class="h-2 bg-indigo-500" :style="'width:' + net.activity + '%'" x-text="''"></div>
      </div>
    </section>

    <!-- Quick Actions & Features -->
    <section class="col-span-3 card" :class="{ 'card-dark': darkMode }">
      <div class="section-title">Quick Actions</div>
      <div class="flex flex-wrap gap-4">
        <button @click="toggleExitNode()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded">Toggle Exit Node</button>
        <button @click="openSubnetModal()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">Manage Subnets</button>
        <button @click="openKeyModal()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">Manage Keys</button>
        <button @click="openLogsModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">View Logs</button>
      </div>
    </section>
  </main>

  <!-- Settings Modal -->
  <div x-show="openSettings" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50" style="display: none;">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 w-full max-w-md">
      <div class="text-lg font-semibold mb-4">Settings</div>
      <div class="mb-4 flex items-center justify-between">
        <span>Dark Mode</span>
        <input type="checkbox" x-model="darkMode" class="h-5 w-5">
      </div>
      <div class="mb-4">
        <label class="block mb-1 font-medium">Refresh Interval (seconds)</label>
        <input type="number" x-model.number="refreshInterval" min="5" max="120" class="w-full px-2 py-1 rounded border border-gray-300 dark:bg-gray-700 dark:text-gray-100">
      </div>
      <div class="flex justify-end gap-2">
        <button @click="openSettings = false" class="px-4 py-2 bg-gray-300 dark:bg-gray-700 rounded">Close</button>
      </div>
    </div>
  </div>

  <!-- Peer Details Modal -->
  <div x-show="peerModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50" style="display: none;">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 w-full max-w-lg">
      <div class="text-lg font-semibold mb-4">Peer Details</div>
      <pre class="bg-gray-100 dark:bg-gray-900 p-2 rounded text-xs overflow-x-auto" x-text="JSON.stringify(selectedPeer, null, 2)"></pre>
      <div class="flex justify-end mt-4">
        <button @click="peerModal = false" class="px-4 py-2 bg-gray-300 dark:bg-gray-700 rounded">Close</button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div x-show="toast" class="fixed bottom-6 right-6 bg-indigo-600 text-white px-4 py-2 rounded shadow-lg z-50" x-text="toast" style="display: none;"></div>

</body>
</html>
