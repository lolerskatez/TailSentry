{% extends "base.html" %}
{% block title %}Appearance Settings - TailSentry{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto py-8 px-4" x-data="appearanceSettings()">
  <!-- Settings Subnavigation -->
  <nav class="flex gap-4 mb-8 max-w-6xl mx-auto" aria-label="Settings Subnavigation">
    <a href="/settings" class="px-3 py-1 rounded font-semibold bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100 hover:bg-indigo-200 hover:text-indigo-900 dark:hover:bg-indigo-800 dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">General</a>
    <a href="/settings/users" class="px-3 py-1 rounded font-semibold bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100 hover:bg-indigo-200 hover:text-indigo-900 dark:hover:bg-indigo-800 dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">Manage Users</a>
    <a href="/settings/appearance" class="px-3 py-1 rounded font-semibold bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-100 focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-current="page">Appearance</a>
    <a href="/settings/tailscale" class="px-3 py-1 rounded font-semibold bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100 hover:bg-indigo-200 hover:text-indigo-900 dark:hover:bg-indigo-800 dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">Tailscale Settings</a>
    <a href="/settings/tailsentry" class="px-3 py-1 rounded font-semibold bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100 hover:bg-indigo-200 hover:text-indigo-900 dark:hover:bg-indigo-800 dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">TailSentry Config</a>
    <a href="/settings/notifications" class="px-3 py-1 rounded font-semibold bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100 hover:bg-indigo-200 hover:text-indigo-900 dark:hover:bg-indigo-800 dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">Notifications</a>
    <a href="/logs" class="px-3 py-1 rounded font-semibold bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100 hover:bg-indigo-200 hover:text-indigo-900 dark:hover:bg-gray-800 dark:hover:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">Logs</a>
  </nav>

  <!-- Toast notification container -->
  <div x-data="{ 
    show: false, 
    message: '', 
    type: '',
    init() {
      window.addEventListener('show-toast', (event) => {
        this.message = event.detail.message;
        this.type = event.detail.type;
        this.show = true;
        setTimeout(() => this.show = false, 3000);
      });
    }
  }" x-show="show" x-transition class="fixed top-6 right-6 z-50">
    <div :class="type === 'success' ? 'bg-green-600' : 'bg-red-600'" class="text-white px-6 py-3 rounded shadow-lg flex items-center gap-2">
      <svg x-show="type === 'success'" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>
      <svg x-show="type === 'error'" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
      <span x-text="message"></span>
    </div>
  </div>

  <!-- ARIA live region for inline feedback -->
  <div aria-live="polite" class="sr-only" id="aria-feedback"></div>

  <div class="max-w-2xl mx-auto">
    <h1 class="text-3xl font-bold text-indigo-800 dark:text-indigo-300 mb-8">Appearance Settings</h1>

    <!-- Theme Settings Card -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-6 mb-6">
      <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
        </svg>
        Theme Preference
      </h2>
      
      <div class="space-y-4">
        <!-- Theme Selection -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Choose Your Theme</label>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
            <!-- System Theme -->
            <label class="relative cursor-pointer">
              <input type="radio" name="theme" value="system" x-model="theme" class="sr-only" @change="applyTheme()">
              <div :class="theme === 'system' ? 'ring-2 ring-indigo-500 border-indigo-500' : 'border-gray-300'" 
                   class="border-2 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
                <div class="flex items-center justify-center mb-2">
                  <svg class="w-8 h-8 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                  </svg>
                </div>
                <div class="text-sm font-medium text-center text-gray-900 dark:text-white">System</div>
                <div class="text-xs text-center text-gray-500 dark:text-gray-400 mt-1">Follow device</div>
              </div>
            </label>

            <!-- Light Theme -->
            <label class="relative cursor-pointer">
              <input type="radio" name="theme" value="light" x-model="theme" class="sr-only" @change="applyTheme()">
              <div :class="theme === 'light' ? 'ring-2 ring-indigo-500 border-indigo-500' : 'border-gray-300'" 
                   class="border-2 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
                <div class="flex items-center justify-center mb-2">
                  <svg class="w-8 h-8 text-yellow-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                  </svg>
                </div>
                <div class="text-sm font-medium text-center text-gray-900 dark:text-white">Light</div>
                <div class="text-xs text-center text-gray-500 dark:text-gray-400 mt-1">Bright & clean</div>
              </div>
            </label>

            <!-- Dark Theme -->
            <label class="relative cursor-pointer">
              <input type="radio" name="theme" value="dark" x-model="theme" class="sr-only" @change="applyTheme()">
              <div :class="theme === 'dark' ? 'ring-2 ring-indigo-500 border-indigo-500' : 'border-gray-300'" 
                   class="border-2 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all">
                <div class="flex items-center justify-center mb-2">
                  <svg class="w-8 h-8 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                  </svg>
                </div>
                <div class="text-sm font-medium text-center text-gray-900 dark:text-white">Dark</div>
                <div class="text-xs text-center text-gray-500 dark:text-gray-400 mt-1">Easy on eyes</div>
              </div>
            </label>
          </div>
        </div>

        <!-- Theme Preview -->
        <div class="mt-6">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Theme Preview</label>
          <div class="border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden">
            <div :class="getPreviewClasses()" class="p-4 transition-all">
              <div class="flex items-center justify-between mb-3">
                <h3 class="font-semibold">TailSentry Dashboard</h3>
                <div class="w-3 h-3 rounded-full bg-green-500"></div>
              </div>
              <div class="space-y-2">
                <div class="h-2 bg-current opacity-20 rounded"></div>
                <div class="h-2 bg-current opacity-15 rounded w-3/4"></div>
                <div class="h-2 bg-current opacity-10 rounded w-1/2"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Interface Settings Card -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-6 mb-6">
      <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
        </svg>
        Interface Settings
      </h2>
      
      <div class="space-y-6">
        <!-- Refresh Interval -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2" for="refresh-interval">
            Dashboard Refresh Interval
          </label>
          <div class="flex items-center space-x-4">
            <input 
              id="refresh-interval" 
              type="range" 
              min="5" 
              max="120" 
              step="5"
              x-model.number="refreshInterval" 
              class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"
              @input="saveRefreshInterval()">
            <div class="flex items-center space-x-2 min-w-[100px]">
              <span x-text="refreshInterval" class="font-medium text-gray-900 dark:text-white"></span>
              <span class="text-sm text-gray-500 dark:text-gray-400">seconds</span>
            </div>
          </div>
          <div class="mt-2 flex justify-between text-xs text-gray-500 dark:text-gray-400">
            <span>Fast (5s)</span>
            <span>Balanced (30s)</span>
            <span>Slow (120s)</span>
          </div>
        </div>

        <!-- Compact Mode -->
        <div class="flex items-center justify-between">
          <div>
            <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Compact Mode</label>
            <p class="text-sm text-gray-500 dark:text-gray-400">Reduce spacing and padding for more information density</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" x-model="compactMode" class="sr-only peer" @change="saveCompactMode()">
            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600"></div>
          </label>
        </div>

        <!-- Animation Preferences -->
        <div class="flex items-center justify-between">
          <div>
            <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Reduce Animations</label>
            <p class="text-sm text-gray-500 dark:text-gray-400">Minimize transitions and animations for better performance</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" x-model="reduceAnimations" class="sr-only peer" @change="saveReduceAnimations()">
            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600"></div>
          </label>
        </div>
      </div>
    </div>

    <!-- Apply & Reset Actions -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 p-6">
      <div class="flex flex-col sm:flex-row gap-4">
        <button 
          @click="saveAllSettings()"
          class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-6 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800">
          Apply Settings
        </button>
        <button 
          @click="resetToDefaults()"
          class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-medium py-3 px-6 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800">
          Reset to Defaults
        </button>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('alpine:init', () => {
    Alpine.data('appearanceSettings', () => ({
        theme: localStorage.getItem('theme') || 'system',
        refreshInterval: parseInt(localStorage.getItem('refreshInterval') || '30'),
        compactMode: localStorage.getItem('compactMode') === 'true',
        reduceAnimations: localStorage.getItem('reduceAnimations') === 'true',

        init() {
            // Apply current theme on load
            this.applyTheme();
            
            // Apply compact mode and animations
            this.applyCompactMode();
            this.applyAnimations();

            // Watch for system theme changes
            if (this.theme === 'system') {
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                    if (this.theme === 'system') {
                        this.applyTheme();
                    }
                });
            }
        },

        applyTheme() {
            const isDark = this.theme === 'dark' || 
                          (this.theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);
            
            if (isDark) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }

            // Save theme preference
            localStorage.setItem('theme', this.theme);
            
            // Show toast notification
            this.showToast('Theme applied successfully!', 'success');
        },

        saveRefreshInterval() {
            localStorage.setItem('refreshInterval', this.refreshInterval.toString());
        },

        saveCompactMode() {
            localStorage.setItem('compactMode', this.compactMode.toString());
            this.applyCompactMode();
        },

        applyCompactMode() {
            if (this.compactMode) {
                document.documentElement.classList.add('compact-mode');
            } else {
                document.documentElement.classList.remove('compact-mode');
            }
        },

        saveReduceAnimations() {
            localStorage.setItem('reduceAnimations', this.reduceAnimations.toString());
            this.applyAnimations();
        },

        applyAnimations() {
            if (this.reduceAnimations) {
                document.documentElement.classList.add('reduce-motion');
            } else {
                document.documentElement.classList.remove('reduce-motion');
            }
        },

        getPreviewClasses() {
            if (this.theme === 'dark') {
                return 'bg-gray-900 text-white';
            } else if (this.theme === 'light') {
                return 'bg-white text-gray-900';
            } else {
                // System theme - show current applied theme
                const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                return isDark ? 'bg-gray-900 text-white' : 'bg-white text-gray-900';
            }
        },

        saveAllSettings() {
            this.applyTheme();
            this.saveRefreshInterval();
            this.saveCompactMode();
            this.saveReduceAnimations();
            
            this.showToast('All appearance settings saved!', 'success');
        },

        resetToDefaults() {
            this.theme = 'system';
            this.refreshInterval = 30;
            this.compactMode = false;
            this.reduceAnimations = false;

            // Apply defaults
            this.applyTheme();
            this.saveRefreshInterval();
            this.saveCompactMode();
            this.saveReduceAnimations();

            this.showToast('Settings reset to defaults', 'success');
        },

        showToast(message, type) {
            // Use Alpine's global store or dispatch custom event
            window.dispatchEvent(new CustomEvent('show-toast', {
                detail: { message, type }
            }));
        }
    }));
});
</script>

<!-- Add custom CSS for compact mode and reduced animations -->
<style>
.compact-mode {
    --spacing-scale: 0.75;
}

.compact-mode .p-4 { padding: calc(1rem * var(--spacing-scale)); }
.compact-mode .p-6 { padding: calc(1.5rem * var(--spacing-scale)); }
.compact-mode .mb-4 { margin-bottom: calc(1rem * var(--spacing-scale)); }
.compact-mode .mb-6 { margin-bottom: calc(1.5rem * var(--spacing-scale)); }

.reduce-motion * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
}

/* Custom range slider styling */
input[type="range"]::-webkit-slider-thumb {
    appearance: none;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #4f46e5;
    cursor: pointer;
}

input[type="range"]::-moz-range-thumb {
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #4f46e5;
    cursor: pointer;
    border: none;
}
</style>
{% endblock %}
