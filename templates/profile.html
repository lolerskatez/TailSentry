{% extends "base.html" %}
{% block title %}Profile - TailSentry{% endblock %}
{% block content %}
<div class="max-w-2xl mx-auto py-8 px-4">
    <h1 class="text-2xl font-bold mb-6 text-indigo-800">Profile Settings</h1>
    <form method="post" action="/profile" class="bg-white dark:bg-gray-800 p-6 rounded shadow-md space-y-6 border border-gray-200 dark:border-gray-700">
        <div>
            <label class="block font-medium mb-1" for="username">Username</label>
            <input type="text" id="username" name="username" class="w-full border rounded px-3 py-2 bg-gray-100 dark:bg-gray-700 dark:text-gray-400" value="{{ user.username }}" readonly>
        </div>
        <div>
            <label class="block font-medium mb-1" for="email">Email</label>
            <input type="email" id="email" name="email" class="w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-gray-100" value="{{ user.email or '' }}" required>
        </div>
        <div>
            <label class="block font-medium mb-1" for="display_name">Display Name</label>
            <input type="text" id="display_name" name="display_name" class="w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-gray-100" value="{{ user.display_name or '' }}">
        </div>
        <div>
            <label class="block font-medium mb-1" for="current_password">Current Password (required to update email or password)</label>
            <input type="password" id="current_password" name="current_password" class="w-full border rounded px-3 py-2">
        </div>
        <div>
            <label class="block font-medium mb-1" for="new_password">New Password (leave blank to keep current)</label>
            <input type="password" id="new_password" name="new_password" class="w-full border rounded px-3 py-2" oninput="checkStrength(this.value)">
            <div id="password-strength" class="mt-1 text-sm"></div>
        </div>
        
        <!-- Notification Preferences Section -->
        <div class="border-t pt-4">
            <h3 class="text-lg font-medium mb-3 text-gray-900 dark:text-white">Notification Preferences</h3>
            <div class="space-y-3">
                <div class="flex items-center">
                    <input type="checkbox" id="email_notifications" name="email_notifications" class="mr-2" 
                           {% if user.notification_preferences.email %}checked{% endif %}>
                    <label for="email_notifications" class="text-sm text-gray-700 dark:text-gray-300">
                        Email Notifications - Receive email alerts for system events
                    </label>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="system_alerts" name="system_alerts" class="mr-2"
                           {% if user.notification_preferences.system_alerts %}checked{% endif %}>
                    <label for="system_alerts" class="text-sm text-gray-700 dark:text-gray-300">
                        System Alerts - Important system status and security notifications
                    </label>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="maintenance" name="maintenance" class="mr-2"
                           {% if user.notification_preferences.maintenance %}checked{% endif %}>
                    <label for="maintenance" class="text-sm text-gray-700 dark:text-gray-300">
                        Maintenance Notifications - Updates about scheduled maintenance and system changes
                    </label>
                </div>
            </div>
        </div>
        
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 w-full">Update Profile</button>
    </form>
    <section class="mt-8">
        <h2 class="text-lg font-semibold text-indigo-700 mb-2">Recent Activity</h2>
        <ul class="text-sm text-gray-700 dark:text-gray-200 list-disc ml-6">
            {% if user and user.activity_log %}
                {% for entry in user.activity_log %}
                    <li>{{ entry }}</li>
                {% endfor %}
            {% else %}
                <li>No recent activity.</li>
            {% endif %}
        </ul>
    </section>
</div>
{% endblock %}
{% block scripts %}
<script>
function checkStrength(pw) {
    const meter = document.getElementById('password-strength');
    if (!pw) { meter.textContent = ''; return; }
    let score = 0;
    if (pw.length >= 8) score++;
    if (/[A-Z]/.test(pw)) score++;
    if (/[a-z]/.test(pw)) score++;
    if (/[0-9]/.test(pw)) score++;
    if (/[^A-Za-z0-9]/.test(pw)) score++;
    const levels = ['Very Weak', 'Weak', 'Medium', 'Strong', 'Very Strong'];
    meter.textContent = 'Strength: ' + levels[score-1 >= 0 ? score-1 : 0];
    meter.className = score >= 4 ? 'text-green-600' : score >= 2 ? 'text-yellow-600' : 'text-red-600';
}
</script>
{% endblock %}
