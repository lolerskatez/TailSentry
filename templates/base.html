<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}TailSentry{% endblock %}</title>
  <link rel="stylesheet" href="/static/tailwind.min.css">
  <link rel="stylesheet" href="/static/dark-mode-addon.css">
  <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
  <style>
    [x-cloak] { display: none !important; }
  </style>
  <script>
    // Global theme initialization - runs before Alpine.js
    (function() {
      const theme = localStorage.getItem('theme') || 'system';
      const isDark = theme === 'dark' || 
                    (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);
      
      if (isDark) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    })();
    
    // Expose CSRF token to inline forms if present in request.state
  window.__CSRF_TOKEN__ = "{{ request.state.csrf_token if request.state.csrf_token is defined else request.cookies.get('csrf_token', '') }}";
  </script>
  {% block head %}{% endblock %}
</head>
<body :class="{ 'dark': darkMode }" class="min-h-screen bg-gray-50 dark:bg-gray-900" x-data="{ darkMode: false, logout: () => window.location.href = '/logout' }">
  <!-- Main Navigation -->
  <nav class="flex items-center justify-between px-6 py-4 bg-indigo-700 dark:bg-gray-800 text-white shadow border-b border-indigo-800 dark:border-gray-700" role="navigation" aria-label="Main Navigation">
    <div class="flex items-center gap-3">
      <img src="/static/favicon.svg" class="h-8 w-8" alt="TailSentry logo">
      <span class="font-bold text-xl tracking-tight">TailSentry</span>
    </div>
    <div class="flex items-center gap-4">
      <a href="/" class="hover:bg-indigo-800 dark:hover:bg-gray-700 px-3 py-1 rounded transition {% if active_nav == 'dashboard' %}bg-indigo-900 dark:bg-gray-600 font-semibold{% endif %}" aria-label="Dashboard" title="Dashboard">Dashboard</a>
  {% if user and user.role == 'admin' %}
  <a href="/settings/tailsentry" class="hover:bg-indigo-800 dark:hover:bg-gray-700 px-3 py-1 rounded transition {% if active_nav == 'settings' %}bg-indigo-900 dark:bg-gray-600 font-semibold{% endif %}" aria-label="Settings" title="Settings">Settings</a>
  {% endif %}
      <a href="/profile" class="hover:bg-indigo-800 dark:hover:bg-gray-700 px-3 py-1 rounded transition flex items-center {% if active_nav == 'profile' %}bg-indigo-900 dark:bg-gray-600 font-semibold{% endif %}" aria-label="Profile" title="Profile">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 15c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
        Profile
      </a>
      <button @click="logout()" class="bg-red-500 hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-700 px-3 py-1 rounded transition-colors" aria-label="Logout" title="Logout">Logout</button>
    </div>
  </nav>
  <main>
    {% block content %}{% endblock %}
  </main>
  
  <!-- Load Alpine.js first, then dashboard scripts -->
  <script defer src="/static/alpine.min.js"></script>
  <script defer src="/static/alpine-focus.min.js"></script>
  <script defer src="/static/dashboard.js"></script>
  
  {% block scripts %}{% endblock %}
</body>
</html>
